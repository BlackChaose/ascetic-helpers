"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _lodash = require("lodash");

// todo add render dropdown
// todo for codes by counties with flags images (because select not work with flags);
// todo add input with configurable mask and
// todo validation function //html5 + html4 && IE 10/11 support;
// todo
const sendRequest = url => {
  /* eslint-disable */
  const xhttp = new XMLHttpRequest();
  /* eslint-enable */

  const req = new Promise((resolve, reject) => {
    xhttp.onreadystatechange = function () {
      if (this.readyState === 4 && this.status === 200) {
        // eslint-disable-line
        const result = xhttp.responseText;
        resolve(JSON.parse(result));
      } else if (this.readyState === 4 && this.status !== 200) {
        reject(new Error(`Error! ${this.readyState} ${this.status}`));
      }
    };

    xhttp.open('POST', url, true);
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhttp.send('mobile_codes=get');
  });
  return req;
};

const renderLabel = obj => {
  const labelInput = document.createElement('label'); // eslint-disable-line

  labelInput.for = obj.getElementsByTagName('input').id;
  labelInput.textContent = ' +';
  obj.append(labelInput);
  return obj;
};

const renderDropDownList = (obj, SortedFlags) => {
  const dropDownHeader = document.createElement('span'); // eslint-disable-line

  const dropDownInput = document.createElement('input'); // eslint-disable-line

  const dropDownList = document.createElement('div'); // eslint-disable-line

  dropDownList.className = 'mobile_input--dropdown-list';
  dropDownHeader.className = 'mobile_input--dropdown-header';
  dropDownInput.className = 'mobile_input--dropdown-input';
  dropDownInput.placeholder = 'код';
  dropDownInput.maxLength = 4;
  dropDownHeader.append(dropDownInput);
  const ul = document.createElement('ul'); // eslint-disable-line

  ul.className = 'mobile_input--dropdown-ul';
  (0, _lodash.forEach)(SortedFlags, el => {
    const li = document.createElement('li'); // eslint-disable-line

    let imgFlag = document.createElement('span'); // eslint-disable-line

    let liText = document.createElement('span'); // eslint-disable-line

    li.className = 'mobile_input--dropdown-li';
    imgFlag.className = 'mobile_input--dropdown-imgflag';
    liText.className = 'mobile_input--dropdown-litext';
    liText.textContent = el.mobile_code;
    imgFlag.style.backgroundImage = `url(img/flags/${el.flag_picture_name})`;
    li.appendChild(imgFlag);
    li.appendChild(liText);
    li.title = el.name_cyr;
    li.addEventListener('click', () => {
      dropDownInput.value = liText.textContent;
      dropDownList.style.display = dropDownList.style.display === 'block' ? 'none' : 'block';
    });
    ul.append(li);
  });
  dropDownList.append(ul);
  const mobileInput = document.createElement('input'); // eslint-disable-line

  mobileInput.className = 'mobile_input--mobile-input';
  obj.append(dropDownHeader);
  obj.append(mobileInput);
  obj.append(dropDownList); // dropDownHeader.addEventListener('click', () => {
  //   dropDownList.style.display = (dropDownList.style.display === 'block') ? 'none' : 'block';
  //   return dropDownList;
  // });
  // dropDownInput.addEventListener('input', (e) => {
  //   e.stopPropagation();
  //   console.log('!!! ', e.target);
  //   console.log('value: ', e.currentTarget.value);
  // });

  dropDownInput.addEventListener('focusin', () => {
    dropDownList.style.display = dropDownList.style.display === 'block' ? 'none' : 'block';
  });
  dropDownInput.addEventListener('focusout', e => {
    console.log('focusout', e.target); // dropDownList.style.display = (dropDownList.style.display === 'block') ? 'none' : 'block';

    /* eslint-disable */

    const searchElement = SortedFlags.filter(el => {
      return el.mobile_code === dropDownInput.value;
    });
    /* eslint-enable */

    if (searchElement.count === 0) {
      console.error('error!');
    } else {
      console.log(searchElement);
    }
  });
  return obj;
};

const upUsedCountry = (codes, countries) => {
  console.log(codes);
  const upList = codes.filter(el => countries.includes(el.name_lat));
  const result = upList.concat(codes);
  console.log(result);
  return result;
};

const formatCodes = arr => {
  const sortArr = (0, _lodash.sortBy)(arr.mobile_codes, [o => o.name_cyr]);
  return upUsedCountry(sortArr, ['Russia', 'Belarus', 'Finland', 'Kazakhstan', 'Kyrgyzstan', 'Azerbaijan', 'Armenia', 'Moldova', 'Tajikistan', 'Uzbekistan']);
};

const renderMobileInput = config => {
  console.log('!', config, 'version lodash: ', _lodash.VERSION);
  sendRequest(config.url).then(MobileCodes => {
    const SortedMobileCodes = formatCodes(MobileCodes);
    renderLabel(config.domObject);
    renderDropDownList(config.domObject, SortedMobileCodes);
  }).catch(error => console.log(error));
  return 0;
};

var _default = renderMobileInput;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2JpbGVJbnB1dENvbXBvbmVudC5qcyJdLCJuYW1lcyI6WyJzZW5kUmVxdWVzdCIsInVybCIsInhodHRwIiwiWE1MSHR0cFJlcXVlc3QiLCJyZXEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXN1bHQiLCJyZXNwb25zZVRleHQiLCJKU09OIiwicGFyc2UiLCJFcnJvciIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwic2VuZCIsInJlbmRlckxhYmVsIiwib2JqIiwibGFiZWxJbnB1dCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImZvciIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiaWQiLCJ0ZXh0Q29udGVudCIsImFwcGVuZCIsInJlbmRlckRyb3BEb3duTGlzdCIsIlNvcnRlZEZsYWdzIiwiZHJvcERvd25IZWFkZXIiLCJkcm9wRG93bklucHV0IiwiZHJvcERvd25MaXN0IiwiY2xhc3NOYW1lIiwicGxhY2Vob2xkZXIiLCJtYXhMZW5ndGgiLCJ1bCIsImVsIiwibGkiLCJpbWdGbGFnIiwibGlUZXh0IiwibW9iaWxlX2NvZGUiLCJzdHlsZSIsImJhY2tncm91bmRJbWFnZSIsImZsYWdfcGljdHVyZV9uYW1lIiwiYXBwZW5kQ2hpbGQiLCJ0aXRsZSIsIm5hbWVfY3lyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInZhbHVlIiwiZGlzcGxheSIsIm1vYmlsZUlucHV0IiwiZSIsImNvbnNvbGUiLCJsb2ciLCJ0YXJnZXQiLCJzZWFyY2hFbGVtZW50IiwiZmlsdGVyIiwiY291bnQiLCJlcnJvciIsInVwVXNlZENvdW50cnkiLCJjb2RlcyIsImNvdW50cmllcyIsInVwTGlzdCIsImluY2x1ZGVzIiwibmFtZV9sYXQiLCJjb25jYXQiLCJmb3JtYXRDb2RlcyIsImFyciIsInNvcnRBcnIiLCJtb2JpbGVfY29kZXMiLCJvIiwicmVuZGVyTW9iaWxlSW5wdXQiLCJjb25maWciLCJWRVJTSU9OIiwidGhlbiIsIk1vYmlsZUNvZGVzIiwiU29ydGVkTW9iaWxlQ29kZXMiLCJkb21PYmplY3QiLCJjYXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxXQUFXLEdBQUlDLEdBQUQsSUFBUztBQUMzQjtBQUNBLFFBQU1DLEtBQUssR0FBRyxJQUFJQyxjQUFKLEVBQWQ7QUFDQTs7QUFDQSxRQUFNQyxHQUFHLEdBQUcsSUFBSUMsT0FBSixDQUFhLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUM1Q0wsSUFBQUEsS0FBSyxDQUFDTSxrQkFBTixHQUEyQixZQUFZO0FBQ3JDLFVBQUksS0FBS0MsVUFBTCxLQUFvQixDQUFwQixJQUF5QixLQUFLQyxNQUFMLEtBQWdCLEdBQTdDLEVBQWtEO0FBQUU7QUFDbEQsY0FBTUMsTUFBTSxHQUFHVCxLQUFLLENBQUNVLFlBQXJCO0FBQ0FOLFFBQUFBLE9BQU8sQ0FBQ08sSUFBSSxDQUFDQyxLQUFMLENBQVdILE1BQVgsQ0FBRCxDQUFQO0FBQ0QsT0FIRCxNQUdPLElBQUksS0FBS0YsVUFBTCxLQUFvQixDQUFwQixJQUF5QixLQUFLQyxNQUFMLEtBQWdCLEdBQTdDLEVBQWtEO0FBQ3ZESCxRQUFBQSxNQUFNLENBQUMsSUFBSVEsS0FBSixDQUFXLFVBQVMsS0FBS04sVUFBVyxJQUFHLEtBQUtDLE1BQU8sRUFBbkQsQ0FBRCxDQUFOO0FBQ0Q7QUFDRixLQVBEOztBQVFBUixJQUFBQSxLQUFLLENBQUNjLElBQU4sQ0FBVyxNQUFYLEVBQW1CZixHQUFuQixFQUF3QixJQUF4QjtBQUNBQyxJQUFBQSxLQUFLLENBQUNlLGdCQUFOLENBQXVCLGNBQXZCLEVBQXVDLG1DQUF2QztBQUNBZixJQUFBQSxLQUFLLENBQUNnQixJQUFOLENBQVcsa0JBQVg7QUFDRCxHQVpXLENBQVo7QUFhQSxTQUFPZCxHQUFQO0FBQ0QsQ0FsQkQ7O0FBb0JBLE1BQU1lLFdBQVcsR0FBSUMsR0FB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Q0FBckM7QUFDQTFELElBQUFBLFdBQVcsQ0FBQ3VELE1BQU0sQ0FBQ0ssU0FBUixDQUFYO0FBQ0FsRCxJQUFBQSxrQkFBa0IsQ0FBQzZDLE1BQU0sQ0FBQ0ssU0FBUixFQUFtQkQsaUJBQW5CLENBQWxCO0FBQ0QsR0FMSCxFQU1HRSxLQU5ILENBTVVwQixLQUFELElBQVdOLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSyxLQUFaLENBTnBCO0FBT0EsU0FBTyxDQUFQO0FBQ0QsQ0FWRDs7ZUFZZWEsaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBmb3JFYWNoLCBzb3J0QnksIFZFUlNJT04sXG59IGZyb20gJ2xvZGFzaCc7XG5cbi8vIHRvZG8gYWRkIHJlbmRlciBkcm9wZG93blxuLy8gdG9kbyBmb3IgY29kZXMgYnkgY291bnRpZXMgd2l0aCBmbGFncyBpbWFnZXMgKGJlY2F1c2Ugc2VsZWN0IG5vdCB3b3JrIHdpdGggZmxhZ3MpO1xuLy8gdG9kbyBhZGQgaW5wdXQgd2l0aCBjb25maWd1cmFibGUgbWFzayBhbmRcbi8vIHRvZG8gdmFsaWRhdGlvbiBmdW5jdGlvbiAvL2h0bWw1ICsgaHRtbDQgJiYgSUUgMTAvMTEgc3VwcG9ydDtcbi8vIHRvZG9cbmNvbnN0IHNlbmRSZXF1ZXN0ID0gKHVybCkgPT4ge1xuICAvKiBlc2xpbnQtZGlzYWJsZSAqL1xuICBjb25zdCB4aHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAvKiBlc2xpbnQtZW5hYmxlICovXG4gIGNvbnN0IHJlcSA9IG5ldyBQcm9taXNlKCgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgeGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PT0gNCAmJiB0aGlzLnN0YXR1cyA9PT0gMjAwKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICAgICAgY29uc3QgcmVzdWx0ID0geGh0dHAucmVzcG9uc2VUZXh0O1xuICAgICAgICByZXNvbHZlKEpTT04ucGFyc2UocmVzdWx0KSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PT0gNCAmJiB0aGlzLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoYEVycm9yISAke3RoaXMucmVhZHlTdGF0ZX0gJHt0aGlzLnN0YXR1c31gKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB4aHR0cC5vcGVuKCdQT1NUJywgdXJsLCB0cnVlKTtcbiAgICB4aHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7XG4gICAgeGh0dHAuc2VuZCgnbW9iaWxlX2NvZGVzPWdldCcpO1xuICB9KSk7XG4gIHJldHVybiByZXE7XG59O1xuXG5jb25zdCByZW5kZXJMYWJlbCA9IChvYmopID0+IHtcbiAgY29uc3QgbGFiZWxJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgbGFiZWxJbnB1dC5mb3IgPSBvYmouZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2lucHV0JykuaWQ7XG4gIGxhYmVsSW5wdXQudGV4dENvbnRlbnQgPSAnICsnO1xuICBvYmouYXBwZW5kKGxhYmVsSW5wdXQpO1xuICByZXR1cm4gb2JqO1xufTtcblxuY29uc3QgcmVuZGVyRHJvcERvd25MaXN0ID0gKG9iaiwgU29ydGVkRmxhZ3MpID0+IHtcbiAgY29uc3QgZHJvcERvd25IZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgY29uc3QgZHJvcERvd25JbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgY29uc3QgZHJvcERvd25MaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblxuICBkcm9wRG93bkxpc3QuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24tbGlzdCc7XG4gIGRyb3BEb3duSGVhZGVyLmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLWRyb3Bkb3duLWhlYWRlcic7XG4gIGRyb3BEb3duSW5wdXQuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24taW5wdXQnO1xuXG4gIGRyb3BEb3duSW5wdXQucGxhY2Vob2xkZXIgPSAn0LrQvtC0JztcbiAgZHJvcERvd25JbnB1dC5tYXhMZW5ndGggPSA0O1xuXG4gIGRyb3BEb3duSGVhZGVyLmFwcGVuZChkcm9wRG93bklucHV0KTtcblxuICBjb25zdCB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgdWwuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24tdWwnO1xuXG4gIGZvckVhY2goU29ydGVkRmxhZ3MsIChlbCkgPT4ge1xuICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIGxldCBpbWdGbGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgbGV0IGxpVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIGxpLmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLWRyb3Bkb3duLWxpJztcbiAgICBpbWdGbGFnLmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLWRyb3Bkb3duLWltZ2ZsYWcnO1xuICAgIGxpVGV4dC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1kcm9wZG93bi1saXRleHQnO1xuXG4gICAgbGlUZXh0LnRleHRDb250ZW50ID0gZWwubW9iaWxlX2NvZGU7XG5cbiAgICBpbWdGbGFnLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoaW1nL2ZsYWdzLyR7ZWwuZmxhZ19waWN0dXJlX25hbWV9KWA7XG5cbiAgICBsaS5hcHBlbmRDaGlsZChpbWdGbGFnKTtcbiAgICBsaS5hcHBlbmRDaGlsZChsaVRleHQpO1xuXG4gICAgbGkudGl0bGUgPSBlbC5uYW1lX2N5cjtcbiAgICBsaS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGRyb3BEb3duSW5wdXQudmFsdWUgPSBsaVRleHQudGV4dENvbnRlbnQ7XG4gICAgICBkcm9wRG93bkxpc3Quc3R5bGUuZGlzcGxheSA9IChkcm9wRG93bkxpc3Quc3R5bGUuZGlzcGxheSA9PT0gJ2Jsb2NrJykgPyAnbm9uZScgOiAnYmxvY2snO1xuICAgIH0pO1xuICAgIHVsLmFwcGVuZChsaSk7XG4gIH0pO1xuXG4gIGRyb3BEb3duTGlzdC5hcHBlbmQodWwpO1xuXG4gIGNvbnN0IG1vYmlsZUlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBtb2JpbGVJbnB1dC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1tb2JpbGUtaW5wdXQnO1xuXG4gIG9iai5hcHBlbmQoZHJvcERvd25IZWFkZXIpO1xuXG4gIG9iai5hcHBlbmQobW9iaWxlSW5wdXQpO1xuXG4gIG9iai5hcHBlbmQoZHJvcERvd25MaXN0KTtcblxuICAvLyBkcm9wRG93bkhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgLy8gICBkcm9wRG93bkxpc3Quc3R5bGUuZGlzcGxheSA9IChkcm9wRG93bkxpc3Quc3R5bGUuZGlzcGxheSA9PT0gJ2Jsb2NrJykgPyAnbm9uZScgOiAnYmxvY2snO1xuICAvLyAgIHJldHVybiBkcm9wRG93bkxpc3Q7XG4gIC8vIH0pO1xuXG4gIC8vIGRyb3BEb3duSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoZSkgPT4ge1xuICAvLyAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIC8vICAgY29uc29sZS5sb2coJyEhISAnLCBlLnRhcmdldCk7XG4gIC8vICAgY29uc29sZS5sb2coJ3ZhbHVlOiAnLCBlLmN1cnJlbnRUYXJnZXQudmFsdWUpO1xuICAvLyB9KTtcblxuICBkcm9wRG93bklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzaW4nLCAoKSA9PiB7XG4gICAgZHJvcERvd25MaXN0LnN0eWxlLmRpc3BsYXkgPSAoZHJvcERvd25MaXN0LnN0eWxlLmRpc3BsYXkgPT09ICdibG9jaycpID8gJ25vbmUnIDogJ2Jsb2NrJztcbiAgfSk7XG5cbiAgZHJvcERvd25JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdmb2N1c291dCcsIChlKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2ZvY3Vzb3V0JywgZS50YXJnZXQpO1xuICAgIC8vIGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID0gKGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snKSA/ICdub25lJyA6ICdibG9jayc7XG4gICAgLyogZXNsaW50LWRpc2FibGUgKi9cbiAgICBjb25zdCBzZWFyY2hFbGVtZW50ID0gU29ydGVkRmxhZ3MuZmlsdGVyKChlbCkgPT4ge1xuICAgICAgcmV0dXJuIGVsLm1vYmlsZV9jb2RlID09PSBkcm9wRG93bklucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIC8qIGVzbGludC1lbmFibGUgKi9cbiAgICBpZiAoc2VhcmNoRWxlbWVudC5jb3VudCA9PT0gMCkge1xuICAgICAgY29uc29sZS5lcnJvcignZXJyb3IhJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKHNlYXJjaEVsZW1lbnQpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBvYmo7XG59O1xuXG5jb25zdCB1cFVzZWRDb3VudHJ5ID0gKGNvZGVzLCBjb3VudHJpZXMpID0+IHtcbiAgY29uc29sZS5sb2coY29kZXMpO1xuICBjb25zdCB1cExpc3QgPSBjb2Rlcy5maWx0ZXIoKGVsKSA9PiBjb3VudHJpZXMuaW5jbHVkZXMoZWwubmFtZV9sYXQpKTtcbiAgY29uc3QgcmVzdWx0ID0gdXBMaXN0LmNvbmNhdChjb2Rlcyk7XG4gIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5jb25zdCBmb3JtYXRDb2RlcyA9IChhcnIpID0+IHtcbiAgY29uc3Qgc29ydEFyciA9IHNvcnRCeShhcnIubW9iaWxlX2NvZGVzLCBbKG8pID0+IG8ubmFtZV9jeXJdKTtcbiAgcmV0dXJuIHVwVXNlZENvdW50cnkoc29ydEFyciwgWydSdXNzaWEnLCAnQmVsYXJ1cycsICdGaW5sYW5kJywgJ0themFraHN0YW4nLCAnS3lyZ3l6c3RhbicsICdBemVyYmFpamFuJywgJ0FybWVuaWEnLCAnTW9sZG92YScsICdUYWppa2lzdGFuJywgJ1V6YmVraXN0YW4nXSk7XG59O1xuXG5jb25zdCByZW5kZXJNb2JpbGVJbnB1dCA9IChjb25maWcpID0+IHtcbiAgY29uc29sZS5sb2coJyEnLCBjb25maWcsICd2ZXJzaW9uIGxvZGFzaDogJywgVkVSU0lPTik7XG4gIHNlbmRSZXF1ZXN0KGNvbmZpZy51cmwpXG4gICAgLnRoZW4oKE1vYmlsZUNvZGVzKSA9PiB7XG4gICAgICBjb25zdCBTb3J0ZWRNb2JpbGVDb2RlcyA9IGZvcm1hdENvZGVzKE1vYmlsZUNvZGVzKTtcbiAgICAgIHJlbmRlckxhYmVsKGNvbmZpZy5kb21PYmplY3QpO1xuICAgICAgcmVuZGVyRHJvcERvd25MaXN0KGNvbmZpZy5kb21PYmplY3QsIFNvcnRlZE1vYmlsZUNvZGVzKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyb3IpID0+IGNvbnNvbGUubG9nKGVycm9yKSk7XG4gIHJldHVybiAwO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgcmVuZGVyTW9iaWxlSW5wdXQ7XG4iXX0=