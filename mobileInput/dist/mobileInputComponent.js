"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _lodash = require("lodash");

// todo validation function //html5 + html4 && IE 10/11 support;
// todo
const sendRequest = url => {
  /* eslint-disable */
  const xhttp = new XMLHttpRequest();
  const req = new Promise((resolve, reject) => {
    xhttp.onreadystatechange = function () {
      if (this.readyState === 4 && this.status === 200) {
        // eslint-disable-line
        const result = xhttp.responseText;
        resolve(JSON.parse(result));
      } else if (this.readyState === 4 && this.status !== 200) {
        reject(new Error(`Error! ${this.readyState} ${this.status}`));
      }
    };

    xhttp.open('POST', url, true);
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhttp.send('mobile_codes=get');
  });
  return req;
  /* eslint-enable */
};

const renderLabel = obj => {
  const labelInput = document.createElement('label'); // eslint-disable-line

  labelInput.for = obj.getElementsByTagName('input').id;
  labelInput.textContent = ' +';
  obj.append(labelInput);
  return obj;
};

const mobileFormat = arr => {
  const str = (0, _lodash.reduce)(arr, (acc, item, key) => {
    let res = acc;

    if (key === 2 || key === 5) {
      res += item;
      res += '-';
      return res;
    }

    res += item;
    return res;
  }, '');
  return str;
};

const renderDropDownList = (obj, SortedFlags, inputMobileDefault, inputCountryCodeDefault, hiddenInputName) => {
  const dropDownHeader = document.createElement('span'); // eslint-disable-line

  const dropDownInput = document.createElement('input'); // eslint-disable-line

  const dropDownList = document.createElement('div'); // eslint-disable-line

  const dropDownHiddenInput = document.createElement('input'); // eslint-disable-line

  dropDownList.className = 'mobile_input--dropdown-list';
  dropDownHeader.className = 'mobile_input--dropdown-header';
  dropDownInput.className = 'mobile_input--dropdown-input';
  dropDownInput.name = 'country_code';
  dropDownInput.readOnly = true;
  dropDownInput.placeholder = 'код';
  dropDownInput.maxLength = 4;
  dropDownInput.value = inputCountryCodeDefault;
  dropDownHiddenInput.type = 'hidden';
  dropDownHiddenInput.name = hiddenInputName || 'mobileInput_Mobile';
  dropDownHeader.append(dropDownInput);
  const ul = document.createElement('ul'); // eslint-disable-line

  ul.className = 'mobile_input--dropdown-ul';
  (0, _lodash.forEach)(SortedFlags, el => {
    const li = document.createElement('li'); // eslint-disable-line

    let imgFlag = document.createElement('span'); // eslint-disable-line

    let liText = document.createElement('span'); // eslint-disable-line

    li.className = 'mobile_input--dropdown-li';
    imgFlag.className = 'mobile_input--dropdown-imgflag';
    liText.className = 'mobile_input--dropdown-litext';
    liText.textContent = el.mobile_code;
    imgFlag.style.backgroundImage = `url(../img/flags/${el.flag_picture_name})`; // imgFlag.style.backgroundImage = `url(img/flags/${el.flag_picture_name})`;

    li.appendChild(imgFlag);
    li.appendChild(liText);
    li.title = el.name_cyr;
    li.addEventListener('click', () => {
      dropDownInput.value = liText.textContent;
      dropDownList.style.display = 'none';
    });
    ul.append(li);
  });
  dropDownList.append(ul);
  const mobileInput = document.createElement('input'); // eslint-disable-line

  mobileInput.className = 'mobile_input--mobile-input';
  mobileInput.pattern = '\\d{3}(\\s|-)\\d{3}(\\s|-)\\d{4}';
  mobileInput.placeholder = 'XXX-XXX-XXXX';
  mobileInput.title = 'номер мобильного телефона';
  mobileInput.type = 'tel';
  mobileInput.required = true;
  mobileInput.value = mobileFormat(inputMobileDefault);
  mobileInput.name = 'mobile_number';
  obj.append(dropDownHeader);
  obj.append(mobileInput);
  obj.append(dropDownList);
  dropDownHiddenInput.value = mobileFormat(inputMobileDefault);
  obj.append(dropDownHiddenInput);

  const HiddenInputHandler = function () {
    dropDownHiddenInput.value = dropDownInput.value + mobileInput.value;
    return dropDownHiddenInput.value;
  };

  const keybuf = inputMobileDefault.split('');
  console.warn('inputMobileDefault.split: ', keybuf); // fixme: доработать буфер - надо считывать значение
  // по умолчанию в буфер + обработка нажатий стрелок

  mobileInput.addEventListener('change', e => {
    console.log(e.key);
  });
  mobileInput.addEventListener('keydown', e => {
    if (isNaN(parseInt(e.key, 10)) && e.key !== 'Backspace' && e.key !== 'Enter') {
      // eslint-disable-line
      e.preventDefault();
      return;
    }

    if (keybuf.length >= 10 && e.key !== 'Backspace') {
      e.preventDefault();
      return;
    }

    if (e.key === 'Backspace') {
      e.preventDefault();
      mobileInput.value = '';
      keybuf.pop();
      mobileInput.value = mobileFormat(keybuf);
      HiddenInputHandler();
      return;
    }

    console.warn('====> ', typeof parseInt(e.key, 10));
    mobileInput.value = '';
    mobileInput.value = mobileFormat(keybuf);
    keybuf.push(e.key);
    HiddenInputHandler();
  });
  dropDownList.addEventListener('mouseleave', () => {
    dropDownList.style.display = 'none';
    HiddenInputHandler();
  });
  dropDownInput.addEventListener('click', () => {
    dropDownList.style.display = dropDownList.style.display === 'block' ? 'none' : 'block';
    HiddenInputHandler();
  });
  mobileInput.addEventListener('focusin', () => {
    dropDownList.style.display = 'none';
    HiddenInputHandler();
  });
  return obj;
};

const upUsedCountry = (codes, countries) => {
  const upList = codes.filter(el => countries.includes(el.name_lat));
  const result = upList.concat(codes);
  return result;
};

const formatCodes = arr => {
  const sortArr = (0, _lodash.sortBy)(arr.mobile_codes, [o => o.name_cyr]);
  return upUsedCountry(sortArr, ['Russia', 'Belarus', 'Finland', 'Kazakhstan', 'Kyrgyzstan', 'Azerbaijan', 'Armenia', 'Moldova', 'Tajikistan', 'Uzbekistan']);
};

const renderMobileInput = config => {
  sendRequest(config.url).then(MobileCodes => {
    const SortedMobileCodes = formatCodes(MobileCodes);
    renderLabel(config.domObject);
    renderDropDownList(config.domObject, SortedMobileCodes, config.defaultMobile, config.defaultCountryCode, config.hiddenInputName);
  }).catch(error => console.log(error));
  return 0;
};

var _default = renderMobileInput;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2JpbGVJbnB1dENvbXBvbmVudC5qcyJdLCJuYW1lcyI6WyJzZW5kUmVxdWVzdCIsInVybCIsInhodHRwIiwiWE1MSHR0cFJlcXVlc3QiLCJyZXEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXN1bHQiLCJyZXNwb25zZVRleHQiLCJKU09OIiwicGFyc2UiLCJFcnJvciIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwic2VuZCIsInJlbmRlckxhYmVsIiwib2JqIiwibGFiZWxJbnB1dCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImZvciIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiaWQiLCJ0ZXh0Q29udGVudCIsImFwcGVuZCIsIm1vYmlsZUZvcm1hdCIsImFyciIsInN0ciIsImFjYyIsIml0ZW0iLCJrZXkiLCJyZXMiLCJyZW5kZXJEcm9wRG93bkxpc3QiLCJTb3J0ZWRGbGFncyIsImlucHV0TW9iaWxlRGVmYXVsdCIsImlucHV0Q291bnRyeUNvZGVEZWZhdWx0IiwiaGlkZGVuSW5wdXROYW1lIiwiZHJvcERvd25IZWFkZXIiLCJkcm9wRG93bklucHV0IiwiZHJvcERvd25MaXN0IiwiZHJvcERvd25IaWRkZW5JbnB1dCIsImNsYXNzTmFtZSIsIm5hbWUiLCJyZWFkT25seSIsInBsYWNlaG9sZGVyIiwibWF4TGVuZ3RoIiwidmFsdWUiLCJ0eXBlIiwidWwiLCJlbCIsImxpIiwiaW1nRmxhZyIsImxpVGV4dCIsIm1vYmlsZV9jb2RlIiwic3R5bGUiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJmbGFnX3BpY3R1cmVfbmFtZSIsImFwcGVuZENoaWxkIiwidGl0bGUiLCJuYW1lX2N5ciIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXNwbGF5IiwibW9iaWxlSW5wdXQiLCJwYXR0ZXJuIiwicmVxdWlyZWQiLCJIaWRkZW5JbnB1dEhhbmRsZXIiLCJrZXlidWYiLCJzcGxpdCIsImNvbnNvbGUiLCJ3YXJuIiwiZSIsImxvZyIsImlzTmFOIiwicGFyc2VJbnQiLCJwcmV2ZW50RGVmYXVsdCIsImxlbmd0aCIsInBvcCIsInB1c2giLCJ1cFVzZWRDb3VudHJ5IiwiY29kZXMiLCJjb3VudHJpZXMiLCJ1cExpc3QiLCJmaWx0ZXIiLCJpbmNsdWRlcyIsIm5hbWVfbGF0IiwiY29uY2F0IiwiZm9ybWF0Q29kZXMiLCJzb3J0QXJyIiwibW9iaWxlX2NvZGVzIiwibyIsInJlbmRlck1vYmlsZUlucHV0IiwiY29uZmlnIiwidGhlbiIsIk1vYmlsZUNvZGVzIiwiU29ydGVkTW9iaWxlQ29kZXMiLCJkb21PYmplY3QiLCJkZWZhdWx0TW9iaWxlIiwiZGVmYXVsdENvdW50cnlDb2RlIiwiY2F0Y2giLCJlcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUlBO0FBQ0E7QUFDQSxNQUFNQSxXQUFXLEdBQUlDLEdBQUQsSUFBUztBQUMzQjtBQUNBLFFBQU1DLEtBQUssR0FBRyxJQUFJQyxjQUFKLEVBQWQ7QUFFQSxRQUFNQyxHQUFHLEdBQUcsSUFBSUMsT0FBSixDQUFhLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUM1Q0wsSUFBQUEsS0FBSyxDQUFDTSxrQkFBTixHQUEyQixZQUFZO0FBQ3JDLFVBQUksS0FBS0MsVUFBTCxLQUFvQixDQUFwQixJQUF5QixLQUFLQyxNQUFMLEtBQWdCLEdBQTdDLEVBQWtEO0FBQUU7QUFDbEQsY0FBTUMsTUFBTSxHQUFHVCxLQUFLLENBQUNVLFlBQXJCO0FBQ0FOLFFBQUFBLE9BQU8sQ0FBQ08sSUFBSSxDQUFDQyxLQUFMLENBQVdILE1BQVgsQ0FBRCxDQUFQO0FBQ0QsT0FIRCxNQUdPLElBQUksS0FBS0YsVUFBTCxLQUFvQixDQUFwQixJQUF5QixLQUFLQyxNQUFMLEtBQWdCLEdBQTdDLEVBQWtEO0FBQ3ZESCxRQUFBQSxNQUFNLENBQUMsSUFBSVEsS0FBSixDQUFXLFVBQVMsS0FBS04sVUFBVyxJQUFHLEtBQUtDLE1BQU8sRUFB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QUFDSSxNQUFQLENBQWNOLEtBQWQsQ0FBZjtBQUNBLFNBQU94RSxNQUFQO0FBQ0QsQ0FKRDs7QUFNQSxNQUFNK0UsV0FBVyxHQUFJNUQsR0FBRCxJQUFTO0FBQzNCLFFBQU02RCxPQUFPLEdBQUcsb0JBQU83RCxHQUFHLENBQUM4RCxZQUFYLEVBQXlCLENBQUVDLENBQUQsSUFBT0EsQ0FBQyxDQUFDOUIsUUFBVixDQUF6QixDQUFoQjtBQUNBLFNBQU9tQixhQUFhLENBQUNTLE9BQUQsRUFBVSxDQUFDLFFBQUQsRUFBVyxTQUFYLEVBQXNCLFNBQXRCLEVBQWlDLFlBQWpDLEVBQStDLFlBQS9DLEVBQTZELFlBQTdELEVBQTJFLFNBQTNFLEVBQXNGLFNBQXRGLEVBQWlHLFlBQWpHLEVBQStHLFlBQS9HLENBQVYsQ0FBcEI7QUFDRCxDQUhEOztBQUtBLE1BQU1HLGlCQUFpQixHQUFJQyxNQUFELElBQVk7QUFDcEMvRixFQUFBQSxXQUFXLENBQUMrRixNQUFNLENBQUM5RixHQUFSLENBQVgsQ0FDRytGLElBREgsQ0FDU0MsV0FBRCxJQUFpQjtBQUNyQixVQUFNQyxpQkFBaUIsR0FBR1IsV0FBVyxDQUFDTyxXQUFELENBQXJDO0FBQ0E5RSxJQUFBQSxXQUFXLENBQUM0RSxNQUFNLENBQUNJLFNBQVIsQ0FBWDtBQUNBL0QsSUFBQUEsa0JBQWtCLENBQUMyRCxNQUFNLENBQUNJLFNBQVIsRUFDaEJELGlCQURnQixFQUNHSCxNQUFNLENBQUNLLGFBRFYsRUFDeUJMLE1BQU0sQ0FBQ00sa0JBRGhDLEVBQ29ETixNQUFNLENBQUN2RCxlQUQzRCxDQUFsQjtBQUVELEdBTkgsRUFPRzhELEtBUEgsQ0FPVUMsS0FBRCxJQUFXL0IsT0FBTyxDQUFDRyxHQUFSLENBQVk0QixLQUFaLENBUHBCO0FBUUEsU0FBTyxDQUFQO0FBQ0QsQ0FWRDs7ZUFZZVQsaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBmb3JFYWNoLCBzb3J0QnksIHJlZHVjZSxcbn0gZnJvbSAnbG9kYXNoJztcblxuLy8gdG9kbyB2YWxpZGF0aW9uIGZ1bmN0aW9uIC8vaHRtbDUgKyBodG1sNCAmJiBJRSAxMC8xMSBzdXBwb3J0O1xuLy8gdG9kb1xuY29uc3Qgc2VuZFJlcXVlc3QgPSAodXJsKSA9PiB7XG4gIC8qIGVzbGludC1kaXNhYmxlICovXG4gIGNvbnN0IHhodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgY29uc3QgcmVxID0gbmV3IFByb21pc2UoKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB4aHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSA0ICYmIHRoaXMuc3RhdHVzID09PSAyMDApIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgICAgICBjb25zdCByZXN1bHQgPSB4aHR0cC5yZXNwb25zZVRleHQ7XG4gICAgICAgIHJlc29sdmUoSlNPTi5wYXJzZShyZXN1bHQpKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5yZWFkeVN0YXRlID09PSA0ICYmIHRoaXMuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihgRXJyb3IhICR7dGhpcy5yZWFkeVN0YXRlfSAke3RoaXMuc3RhdHVzfWApKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHhodHRwLm9wZW4oJ1BPU1QnLCB1cmwsIHRydWUpO1xuICAgIHhodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTtcbiAgICB4aHR0cC5zZW5kKCdtb2JpbGVfY29kZXM9Z2V0Jyk7XG4gIH0pKTtcbiAgcmV0dXJuIHJlcTtcbiAgLyogZXNsaW50LWVuYWJsZSAqL1xufTtcblxuY29uc3QgcmVuZGVyTGFiZWwgPSAob2JqKSA9PiB7XG4gIGNvbnN0IGxhYmVsSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIGxhYmVsSW5wdXQuZm9yID0gb2JqLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbnB1dCcpLmlkO1xuICBsYWJlbElucHV0LnRleHRDb250ZW50ID0gJyArJztcbiAgb2JqLmFwcGVuZChsYWJlbElucHV0KTtcbiAgcmV0dXJuIG9iajtcbn07XG5cbmNvbnN0IG1vYmlsZUZvcm1hdCA9IChhcnIpID0+IHtcbiAgY29uc3Qgc3RyID0gcmVkdWNlKGFyciwgKGFjYywgaXRlbSwga2V5KSA9PiB7XG4gICAgbGV0IHJlcyA9IGFjYztcbiAgICBpZiAoa2V5ID09PSAyIHx8IGtleSA9PT0gNSkge1xuICAgICAgcmVzICs9IGl0ZW07XG4gICAgICByZXMgKz0gJy0nO1xuICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG4gICAgcmVzICs9IGl0ZW07XG4gICAgcmV0dXJuIHJlcztcbiAgfSwgJycpO1xuICByZXR1cm4gc3RyO1xufTtcblxuY29uc3QgcmVuZGVyRHJvcERvd25MaXN0ID0gKG9iaixcbiAgU29ydGVkRmxhZ3MsXG4gIGlucHV0TW9iaWxlRGVmYXVsdCxcbiAgaW5wdXRDb3VudHJ5Q29kZURlZmF1bHQsXG4gIGhpZGRlbklucHV0TmFtZSkgPT4ge1xuICBjb25zdCBkcm9wRG93bkhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBjb25zdCBkcm9wRG93bklucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBjb25zdCBkcm9wRG93bkxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBjb25zdCBkcm9wRG93bkhpZGRlbklucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXG4gIGRyb3BEb3duTGlzdC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1kcm9wZG93bi1saXN0JztcbiAgZHJvcERvd25IZWFkZXIuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24taGVhZGVyJztcbiAgZHJvcERvd25JbnB1dC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1kcm9wZG93bi1pbnB1dCc7XG4gIGRyb3BEb3duSW5wdXQubmFtZSA9ICdjb3VudHJ5X2NvZGUnO1xuICBkcm9wRG93bklucHV0LnJlYWRPbmx5ID0gdHJ1ZTtcbiAgZHJvcERvd25JbnB1dC5wbGFjZWhvbGRlciA9ICfQutC+0LQnO1xuICBkcm9wRG93bklucHV0Lm1heExlbmd0aCA9IDQ7XG4gIGRyb3BEb3duSW5wdXQudmFsdWUgPSBpbnB1dENvdW50cnlDb2RlRGVmYXVsdDtcblxuICBkcm9wRG93bkhpZGRlbklucHV0LnR5cGUgPSAnaGlkZGVuJztcbiAgZHJvcERvd25IaWRkZW5JbnB1dC5uYW1lID0gaGlkZGVuSW5wdXROYW1lIHx8ICdtb2JpbGVJbnB1dF9Nb2JpbGUnO1xuXG4gIGRyb3BEb3duSGVhZGVyLmFwcGVuZChkcm9wRG93bklucHV0KTtcblxuICBjb25zdCB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgdWwuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24tdWwnO1xuXG4gIGZvckVhY2goU29ydGVkRmxhZ3MsIChlbCkgPT4ge1xuICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIGxldCBpbWdGbGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgbGV0IGxpVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIGxpLmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLWRyb3Bkb3duLWxpJztcbiAgICBpbWdGbGFnLmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLWRyb3Bkb3duLWltZ2ZsYWcnO1xuICAgIGxpVGV4dC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1kcm9wZG93bi1saXRleHQnO1xuXG4gICAgbGlUZXh0LnRleHRDb250ZW50ID0gZWwubW9iaWxlX2NvZGU7XG5cbiAgICBpbWdGbGFnLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoLi4vaW1nL2ZsYWdzLyR7ZWwuZmxhZ19waWN0dXJlX25hbWV9KWA7XG4gICAgLy8gaW1nRmxhZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKGltZy9mbGFncy8ke2VsLmZsYWdfcGljdHVyZV9uYW1lfSlgO1xuXG4gICAgbGkuYXBwZW5kQ2hpbGQoaW1nRmxhZyk7XG4gICAgbGkuYXBwZW5kQ2hpbGQobGlUZXh0KTtcblxuICAgIGxpLnRpdGxlID0gZWwubmFtZV9jeXI7XG4gICAgbGkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBkcm9wRG93bklucHV0LnZhbHVlID0gbGlUZXh0LnRleHRDb250ZW50O1xuICAgICAgZHJvcERvd25MaXN0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfSk7XG4gICAgdWwuYXBwZW5kKGxpKTtcbiAgfSk7XG5cbiAgZHJvcERvd25MaXN0LmFwcGVuZCh1bCk7XG5cbiAgY29uc3QgbW9iaWxlSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIG1vYmlsZUlucHV0LmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLW1vYmlsZS1pbnB1dCc7XG4gIG1vYmlsZUlucHV0LnBhdHRlcm4gPSAnXFxcXGR7M30oXFxcXHN8LSlcXFxcZHszfShcXFxcc3wtKVxcXFxkezR9JztcbiAgbW9iaWxlSW5wdXQucGxhY2Vob2xkZXIgPSAnWFhYLVhYWC1YWFhYJztcbiAgbW9iaWxlSW5wdXQudGl0bGUgPSAn0L3QvtC80LXRgCDQvNC+0LHQuNC70YzQvdC+0LPQviDRgtC10LvQtdGE0L7QvdCwJztcbiAgbW9iaWxlSW5wdXQudHlwZSA9ICd0ZWwnO1xuICBtb2JpbGVJbnB1dC5yZXF1aXJlZCA9IHRydWU7XG4gIG1vYmlsZUlucHV0LnZhbHVlID0gbW9iaWxlRm9ybWF0KGlucHV0TW9iaWxlRGVmYXVsdCk7XG4gIG1vYmlsZUlucHV0Lm5hbWUgPSAnbW9iaWxlX251bWJlcic7XG5cbiAgb2JqLmFwcGVuZChkcm9wRG93bkhlYWRlcik7XG5cbiAgb2JqLmFwcGVuZChtb2JpbGVJbnB1dCk7XG5cbiAgb2JqLmFwcGVuZChkcm9wRG93bkxpc3QpO1xuXG4gIGRyb3BEb3duSGlkZGVuSW5wdXQudmFsdWUgPSBtb2JpbGVGb3JtYXQoaW5wdXRNb2JpbGVEZWZhdWx0KTtcblxuICBvYmouYXBwZW5kKGRyb3BEb3duSGlkZGVuSW5wdXQpO1xuXG4gIGNvbnN0IEhpZGRlbklucHV0SGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBkcm9wRG93bkhpZGRlbklucHV0LnZhbHVlID0gZHJvcERvd25JbnB1dC52YWx1ZSArIG1vYmlsZUlucHV0LnZhbHVlO1xuICAgIHJldHVybiBkcm9wRG93bkhpZGRlbklucHV0LnZhbHVlO1xuICB9O1xuXG4gIGNvbnN0IGtleWJ1ZiA9IGlucHV0TW9iaWxlRGVmYXVsdC5zcGxpdCgnJyk7XG4gIGNvbnNvbGUud2FybignaW5wdXRNb2JpbGVEZWZhdWx0LnNwbGl0OiAnLCBrZXlidWYpO1xuICAvLyBmaXhtZTog0LTQvtGA0LDQsdC+0YLQsNGC0Ywg0LHRg9GE0LXRgCAtINC90LDQtNC+INGB0YfQuNGC0YvQstCw0YLRjCDQt9C90LDRh9C10L3QuNC1XG4gIC8vINC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOINCyINCx0YPRhNC10YAgKyDQvtCx0YDQsNCx0L7RgtC60LAg0L3QsNC20LDRgtC40Lkg0YHRgtGA0LXQu9C+0LpcbiAgbW9iaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsgY29uc29sZS5sb2coZS5rZXkpOyB9KTtcbiAgbW9iaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XG4gICAgaWYgKGlzTmFOKHBhcnNlSW50KGUua2V5LCAxMCkpICYmIGUua2V5ICE9PSAnQmFja3NwYWNlJyAmJiBlLmtleSAhPT0gJ0VudGVyJykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChrZXlidWYubGVuZ3RoID49IDEwICYmIGUua2V5ICE9PSAnQmFja3NwYWNlJykge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZS5rZXkgPT09ICdCYWNrc3BhY2UnKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBtb2JpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAga2V5YnVmLnBvcCgpO1xuICAgICAgbW9iaWxlSW5wdXQudmFsdWUgPSBtb2JpbGVGb3JtYXQoa2V5YnVmKTtcbiAgICAgIEhpZGRlbklucHV0SGFuZGxlcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zb2xlLndhcm4oJz09PT0+ICcsIHR5cGVvZiAocGFyc2VJbnQoZS5rZXksIDEwKSkpO1xuICAgIG1vYmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAgbW9iaWxlSW5wdXQudmFsdWUgPSBtb2JpbGVGb3JtYXQoa2V5YnVmKTtcbiAgICBrZXlidWYucHVzaChlLmtleSk7XG4gICAgSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gIH0pO1xuXG4gIGRyb3BEb3duTGlzdC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKCkgPT4ge1xuICAgIGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIEhpZGRlbklucHV0SGFuZGxlcigpO1xuICB9KTtcblxuICBkcm9wRG93bklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID0gKGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snKSA/ICdub25lJyA6ICdibG9jayc7XG4gICAgSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gIH0pO1xuXG4gIG1vYmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzaW4nLCAoKSA9PiB7XG4gICAgZHJvcERvd25MaXN0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gIH0pO1xuXG4gIHJldHVybiBvYmo7XG59O1xuXG5jb25zdCB1cFVzZWRDb3VudHJ5ID0gKGNvZGVzLCBjb3VudHJpZXMpID0+IHtcbiAgY29uc3QgdXBMaXN0ID0gY29kZXMuZmlsdGVyKChlbCkgPT4gY291bnRyaWVzLmluY2x1ZGVzKGVsLm5hbWVfbGF0KSk7XG4gIGNvbnN0IHJlc3VsdCA9IHVwTGlzdC5jb25jYXQoY29kZXMpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcblxuY29uc3QgZm9ybWF0Q29kZXMgPSAoYXJyKSA9PiB7XG4gIGNvbnN0IHNvcnRBcnIgPSBzb3J0QnkoYXJyLm1vYmlsZV9jb2RlcywgWyhvKSA9PiBvLm5hbWVfY3lyXSk7XG4gIHJldHVybiB1cFVzZWRDb3VudHJ5KHNvcnRBcnIsIFsnUnVzc2lhJywgJ0JlbGFydXMnLCAnRmlubGFuZCcsICdLYXpha2hzdGFuJywgJ0t5cmd5enN0YW4nLCAnQXplcmJhaWphbicsICdBcm1lbmlhJywgJ01vbGRvdmEnLCAnVGFqaWtpc3RhbicsICdVemJla2lzdGFuJ10pO1xufTtcblxuY29uc3QgcmVuZGVyTW9iaWxlSW5wdXQgPSAoY29uZmlnKSA9PiB7XG4gIHNlbmRSZXF1ZXN0KGNvbmZpZy51cmwpXG4gICAgLnRoZW4oKE1vYmlsZUNvZGVzKSA9PiB7XG4gICAgICBjb25zdCBTb3J0ZWRNb2JpbGVDb2RlcyA9IGZvcm1hdENvZGVzKE1vYmlsZUNvZGVzKTtcbiAgICAgIHJlbmRlckxhYmVsKGNvbmZpZy5kb21PYmplY3QpO1xuICAgICAgcmVuZGVyRHJvcERvd25MaXN0KGNvbmZpZy5kb21PYmplY3QsXG4gICAgICAgIFNvcnRlZE1vYmlsZUNvZGVzLCBjb25maWcuZGVmYXVsdE1vYmlsZSwgY29uZmlnLmRlZmF1bHRDb3VudHJ5Q29kZSwgY29uZmlnLmhpZGRlbklucHV0TmFtZSk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycm9yKSA9PiBjb25zb2xlLmxvZyhlcnJvcikpO1xuICByZXR1cm4gMDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHJlbmRlck1vYmlsZUlucHV0O1xuIl19