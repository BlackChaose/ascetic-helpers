"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _lodash = require("lodash");

var sendRequest = function sendRequest(url) {
  /* eslint-disable */
  var xhttp = new XMLHttpRequest();
  var req = new Promise(function (resolve, reject) {
    xhttp.onreadystatechange = function () {
      if (this.readyState === 4 && this.status === 200) {
        // eslint-disable-line
        var result = xhttp.responseText;
        resolve(JSON.parse(result));
      } else if (this.readyState === 4 && this.status !== 200) {
        reject(new Error("Error! ".concat(this.readyState, " ").concat(this.status)));
      }
    };

    xhttp.open('POST', url, true);
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhttp.send('mobile_codes=get');
  });
  return req;
  /* eslint-enable */
};

var renderLabel = function renderLabel(obj) {
  var labelInput = document.createElement('label'); // eslint-disable-line

  labelInput.for = obj.getElementsByTagName('input').id;
  labelInput.textContent = ' +';
  obj.appendChild(labelInput);
  return obj;
};

var mobileFormat = function mobileFormat(arr) {
  var str = (0, _lodash.reduce)(arr, function (acc, item, key) {
    var res = acc;

    if (key === 2 || key === 5) {
      res += item;
      res += '-';
      return res;
    }

    res += item;
    return res;
  }, '');
  return str;
};

var renderDropDownList = function renderDropDownList(obj, SortedFlags, inputMobileDefault, inputCountryCodeDefault, hiddenInputName, borderStyle) {
  var dropDownHeader = document.createElement('span'); // eslint-disable-line

  var dropDownInput = document.createElement('input'); // eslint-disable-line

  var dropDownList = document.createElement('div'); // eslint-disable-line

  var dropDownHiddenInput = document.createElement('input'); // eslint-disable-line

  var dropDownArrow = document.createElement('div'); // eslint-disable-line

  dropDownList.className = 'mobile_input--dropdown-list';
  dropDownHeader.className = 'mobile_input--dropdown-header';

  if (borderStyle === 'red') {
    dropDownInput.className = 'mobile_input--dropdown-input-red';
  } else if (borderStyle === 'define') {
    dropDownInput.className = 'mobile_input--dropdown-input';
  }

  dropDownInput.name = 'country_code';
  dropDownInput.readOnly = true;
  dropDownInput.placeholder = 'код';
  dropDownInput.maxLength = 4;
  dropDownInput.value = inputCountryCodeDefault;
  dropDownHiddenInput.type = 'hidden';
  dropDownHiddenInput.name = hiddenInputName || 'mobileInput_Mobile';
  dropDownHeader.appendChild(dropDownInput);
  var ul = document.createElement('ul'); // eslint-disable-line

  ul.className = 'mobile_input--dropdown-ul';
  (0, _lodash.forEach)(SortedFlags, function (el) {
    var li = document.createElement('li'); // eslint-disable-line

    var imgFlag = document.createElement('span'); // eslint-disable-line

    var liText = document.createElement('span'); // eslint-disable-line

    li.className = 'mobile_input--dropdown-li';
    imgFlag.className = 'mobile_input--dropdown-imgflag';
    liText.className = 'mobile_input--dropdown-litext';
    liText.textContent = el.mobile_code;
    imgFlag.style.backgroundImage = "url(../img/flags/".concat(el.flag_picture_name, ")"); // imgFlag.style.backgroundImage = `url(img/flags/${el.flag_picture_name})`;

    li.appendChild(imgFlag);
    li.appendChild(liText);
    li.title = el.name_cyr;
    li.addEventListener('click', function () {
      dropDownInput.value = liText.textContent;
      dropDownList.style.display = 'none';
    });
    ul.appendChild(li);
  });
  dropDownList.appendChild(ul);
  var mobileInput = document.createElement('input'); // eslint-disable-line

  if (borderStyle === 'red') {
    mobileInput.className = 'mobile_input--mobile-input-red';
  } else if (borderStyle === 'define') {
    mobileInput.className = 'mobile_input--mobile-input';
  }

  mobileInput.pattern = '\\d{3}(\\s|-)\\d{3}(\\s|-)\\d{4}';
  mobileInput.placeholder = 'XXX-XXX-XXXX';
  mobileInput.title = 'номер мобильного телефона';
  mobileInput.type = 'tel';
  mobileInput.required = true;
  mobileInput.value = mobileFormat(inputMobileDefault);
  mobileInput.name = 'mobile_number';
  mobileInput.autocomplete = 'off';
  obj.appendChild(dropDownHeader);
  dropDownHeader.appendChild(dropDownArrow);
  obj.appendChild(mobileInput);
  obj.appendChild(dropDownList);
  dropDownHiddenInput.value = mobileFormat(inputMobileDefault);
  obj.appendChild(dropDownHiddenInput);

  var HiddenInputHandler = function HiddenInputHandler() {
    dropDownHiddenInput.value = dropDownInput.value + mobileInput.value;
    return dropDownHiddenInput.value;
  };

  var getSelectionIndex = function getSelectionIndex(e) {
    if (e.target.selectionStart === e.target.selectionEnd) {
      if (e.target.selectionStart >= 0 && e.target.selectionStart < 3) {
        return {
          index: e.target.selectionStart,
          count: 1
        };
      }

      if (e.target.selectionStart > 3 && e.target.selectionStart < 7) {
        return {
          index: e.target.selectionStart - 1,
          count: 1
        };
      }

      if (e.target.selectionStart > 7 && e.target.selectionStart <= 12) {
        return {
          index: e.target.selectionStart - 2,
          count: 1
        };
      }
    } // fixme:


    var count = 0;

    if (e.target.selectionStart >= 0 && e.target.selectionStart < 3 && e.target.selectionEnd > 0 && e.target.selectionEnd < 3) {
      // console.log('1 =>');
      count = e.target.selectionEnd - e.target.selectionStart;
      return {
        index: e.target.selectionStart,
        cnt: count
      };
    }

    if (e.target.selectionStart > 3 && e.target.selectionStart < 7 && e.target.selectionEnd > 3 && e.target.selectionEnd < 7) {
      // console.log('2 =>');
      count = e.target.selectionEnd - e.target.selectionStart;
      return {
        index: e.target.selectionStart - 1,
        cnt: count
      };
    }

    if (e.target.selectionStart > 7 && e.target.selectionStart <= 12 && e.target.selectionEnd > 8 && e.target.selectionEnd <= 12) {
      // console.log('3 =>');
      count = e.target.selectionEnd - e.target.selectionStart;
      return {
        index: e.target.selectionStart - 2,
        cnt: count
      };
    }

    if (e.target.selectionStart >= 0 && e.target.selectionStart < 3 && e.target.selectionEnd > 3 && e.target.selectionEnd <= 7) {
      // console.log('4 =>');
      count = e.target.selectionEnd - e.target.selectionStart - 1;
      return {
        index: e.target.selectionStart,
        cnt: count
      };
    }

    if (e.target.selectionStart >= 0 && e.target.selectionStart <= 3 && e.target.selectionEnd > 7 && e.target.selectionEnd <= 12) {
      // console.log('5 =>');
      count = e.target.selectionEnd - e.target.selectionStart - 2;
      return {
        index: e.target.selectionStart,
        cnt: count
      };
    }

    if (e.target.selectionStart > 3 && e.target.selectionStart <= 7 && e.target.selectionEnd >= 3 && e.target.selectionEnd <= 12) {
      // console.log('6 =>');
      count = e.target.selectionEnd - e.target.selectionStart - 1;
      return {
        index: e.target.selectionStart - 1,
        cnt: count
      };
    }

    return {
      index: e.target.selectionStart,
      count: count
    };
  };

  var keybuf = inputMobileDefault.split('');
  console.warn('inputMobileDefault.split: ', keybuf); // по умолчанию в буфер + обработка нажатий стрелок

  mobileInput.addEventListener('change', function (e) {
    console.log(e.key);
  });
  mobileInput.addEventListener('keydown', function (e) {
    console.log(e.key);
    console.warn(keybuf.length); // ArrowRight ArrowLeft ArrowUp ArrowDown Delete

    if (isNaN(parseInt(e.key, 10)) && e.key !== 'Backspace' && e.key !== 'Enter' && e.key !== 'Delete' // eslint-disable-line
    && e.key !== 'ArrowRight' && e.key !== 'ArrowLeft') {
      // eslint-disable-line
      e.preventDefault();
      return;
    }

    if (keybuf.length >= 10 && e.key !== 'Backspace' && e.key !== 'Enter' && e.key !== 'Delete' // eslint-disable-line
    && e.key !== 'ArrowRight' && e.key !== 'ArrowLeft') {
      e.preventDefault();
      return;
    }
    /* fixme */


    if (e.key === 'Backspace') {
      e.preventDefault(); // mobileInput.value = '';
      // console.log(keybuf[e.target.selectionStart]);
      // console.log(e.target.selectionStart);
      // console.log(e.target.selectionEnd);

      console.log(getSelectionIndex(e));
      var spldt = getSelectionIndex(e);
      /* fixme  items.splice(1, 1, 1010); */

      mobileInput.value = '';
      keybuf.splice(spldt.index, spldt.count);
      console.warn('keybuf: ', keybuf);
      mobileInput.value = mobileFormat(keybuf);
      HiddenInputHandler();
      return;
    }
    /* fixme: */


    if (e.key === 'Delete') {
      e.preventDefault();
      mobileInput.value = '';
      /* fixme: */

      keybuf.pop();
      mobileInput.value = mobileFormat(keybuf);
      HiddenInputHandler();
      return;
    }

    if (e.key === 'ArrowLeft') {
      e.preventDefault(); // mobileInput.value = '';

      if (e.target.selectionStart > 0) {
        e.target.selectionStart -= 1;
        e.target.selectionEnd -= 1;
      }
      /* fixme: */
      // keybuf.pop();
      // mobileInput.value = mobileFormat(keybuf);
      // HiddenInputHandler();


      return;
    }

    if (e.key === 'ArrowRight') {
      e.preventDefault(); // mobileInput.value = '';

      if (e.target.selectionStart >= 0 && e.target.selectionEnd <= 12) {
        e.target.selectionStart += 1;
      }
      /* fixme: */
      // keybuf.pop();
      // mobileInput.value = mobileFormat(keybuf);
      // HiddenInputHandler();


      return;
    }

    e.preventDefault();
    mobileInput.value = '';
    keybuf.push(e.key);
    mobileInput.value = mobileFormat(keybuf);
    HiddenInputHandler();
  });
  mobileInput.addEventListener('keyup', function (e) {
    console.log('Caret at: ', e.target.selectionStart);
  });
  dropDownList.addEventListener('mouseleave', function () {
    dropDownList.style.display = 'none';
    HiddenInputHandler();
  });
  dropDownInput.addEventListener('click', function () {
    dropDownList.style.display = dropDownList.style.display === 'block' ? 'none' : 'block';
    HiddenInputHandler();
  });
  dropDownArrow.className = 'mobile_input--dropdown-header-arrow';
  dropDownArrow.textContent = '▼';
  dropDownArrow.addEventListener('click', function () {
    dropDownList.style.display = dropDownList.style.display === 'block' ? 'none' : 'block';
    HiddenInputHandler();
  });
  mobileInput.addEventListener('focusin', function () {
    dropDownList.style.display = 'none';
    HiddenInputHandler();
  });
  return obj;
};

var upUsedCountry = function upUsedCountry(codes, countries) {
  var upList = codes.filter(function (el) {
    return countries.includes(el.name_lat);
  });
  var result = upList.concat(codes);
  return result;
};

var formatCodes = function formatCodes(arr) {
  var sortArr = (0, _lodash.sortBy)(arr.mobile_codes, [function (o) {
    return o.mobile_code;
  }]);
  return upUsedCountry(sortArr, ['Russia']);
};

var renderMobileInput = function renderMobileInput(config) {
  sendRequest(config.url).then(function (MobileCodes) {
    var SortedMobileCodes = formatCodes(MobileCodes);
    renderLabel(config.domObject);
    renderDropDownList(config.domObject, SortedMobileCodes, config.defaultMobile, config.defaultCountryCode, config.hiddenInputName, config.borderStyle);
  }).catch(function (error) {
    return console.log(error);
  });
  return 0;
};

var _default = renderMobileInput;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2JpbGVJbnB1dENvbXBvbmVudC5qcyJdLCJuYW1lcyI6WyJzZW5kUmVxdWVzdCIsInVybCIsInhodHRwIiwiWE1MSHR0cFJlcXVlc3QiLCJyZXEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXN1bHQiLCJyZXNwb25zZVRleHQiLCJKU09OIiwicGFyc2UiLCJFcnJvciIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwic2VuZCIsInJlbmRlckxhYmVsIiwib2JqIiwibGFiZWxJbnB1dCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImZvciIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiaWQiLCJ0ZXh0Q29udGVudCIsImFwcGVuZENoaWxkIiwibW9iaWxlRm9ybWF0IiwiYXJyIiwic3RyIiwiYWNjIiwiaXRlbSIsImtleSIsInJlcyIsInJlbmRlckRyb3BEb3duTGlzdCIsIlNvcnRlZEZsYWdzIiwiaW5wdXRNb2JpbGVEZWZhdWx0IiwiaW5wdXRDb3VudHJ5Q29kZURlZmF1bHQiLCJoaWRkZW5JbnB1dE5hbWUiLCJib3JkZXJTdHlsZSIsImRyb3BEb3duSGVhZGVyIiwiZHJvcERvd25JbnB1dCIsImRyb3BEb3duTGlzdCIsImRyb3BEb3duSGlkZGVuSW5wdXQiLCJkcm9wRG93bkFycm93IiwiY2xhc3NOYW1lIiwibmFtZSIsInJlYWRPbmx5IiwicGxhY2Vob2xkZXIiLCJtYXhMZW5ndGgiLCJ2YWx1ZSIsInR5cGUiLCJ1bCIsImVsIiwibGkiLCJpbWdGbGFnIiwibGlUZXh0IiwibW9iaWxlX2NvZGUiLCJzdHlsZSIsImJhY2tncm91bmRJbWFnZSIsImZsYWdfcGljdHVyZV9uYW1lIiwidGl0bGUiLCJuYW1lX2N5ciIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXNwbGF5IiwibW9iaWxlSW5wdXQiLCJwYXR0ZXJuIiwicmVxdWlyZWQiLCJhdXRvY29tcGxldGUiLCJIaWRkZW5JbnB1dEhhbmRsZXIiLCJnZXRTZWxlY3Rpb25JbmRleCIsImUiLCJ0YXJnZXQiLCJzZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvbkVuZCIsImluZGV4IiwiY291bnQiLCJjbnQiLCJrZXlidWYiLCJzcGxpdCIsImNvbnNvbGUiLCJ3YXJuIiwibG9nIiwibGVuZ3RoIiwiaXNOYU4iLCJwYXJzZUludCIsInByZXZlbnREZWZhdWx0Iiwic3BsZHQiLCJzcGxpY2UiLCJwb3AiLCJwdXNoIiwidXBVc2VkQ291bnRyeSIsImNvZGVzIiwiY291bnRyaWVzIiwidXBMaXN0IiwiZmlsdGVyIiwiaW5jbHVkZXMiLCJuYW1lX2xhdCIsImNvbmNhdCIsImZvcm1hdENvZGVzIiwic29ydEFyciIsIm1vYmlsZV9jb2RlcyIsIm8iLCJyZW5kZXJNb2JpbGVJbnB1dCIsImNvbmZpZyIsInRoZW4iLCJNb2JpbGVDb2RlcyIsIlNvcnRlZE1vYmlsZUNvZGVzIiwiZG9tT2JqZWN0IiwiZGVmYXVsdE1vYmlsZSIsImRlZmF1bHRDb3VudHJ5Q29kZSIsImNhdGNoIiwiZXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFJQSxJQUFNQSxXQUFXLEdBQUcsU0FBZEEsV0FBYyxDQUFDQyxHQUFELEVBQVM7QUFDM0I7QUFDQSxNQUFNQyxLQUFLLEdBQUcsSUFBSUMsY0FBSixFQUFkO0FBRUEsTUFBTUMsR0FBRyxHQUFHLElBQUlDLE9BQUosQ0FBYSxVQUFDQyxPQUFELEVBQVVDLE1BQVYsRUFBcUI7QUFDNUNMLElBQUFBLEtBQUssQ0FBQ00sa0JBQU4sR0FBMkIsWUFBWTtBQUNyQyxVQUFJLEtBQUtDLFVBQUwsS0FBb0IsQ0FBcEIsSUFBeUIsS0FBS0MsTUFBTCxLQUFnQixHQUE3QyxFQUFrRDtBQUFFO0FBQ2xELFlBQU1DLE1BQU0sR0FBR1QsS0FBSyxDQUFDVSxZQUFyQjtBQUNBTixRQUFBQSxPQUFPLENBQUNPLElBQUksQ0FBQ0MsS0FBTCxDQUFXSCxNQUFYLENBQUQsQ0FBUDtBQUNELE9BSEQs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RSxJQUFBQSxrQkFBa0IsQ0FDaEJzRSxNQUFNLENBQUNJLFNBRFMsRUFFaEJELGlCQUZnQixFQUdoQkgsTUFBTSxDQUFDSyxhQUhTLEVBSWhCTCxNQUFNLENBQUNNLGtCQUpTLEVBS2hCTixNQUFNLENBQUNsRSxlQUxTLEVBTWhCa0UsTUFBTSxDQUFDakUsV0FOUyxDQUFsQjtBQVFELEdBWkgsRUFhR3dFLEtBYkgsQ0FhUyxVQUFDQyxLQUFEO0FBQUEsV0FBV2hDLE9BQU8sQ0FBQ0UsR0FBUixDQUFZOEIsS0FBWixDQUFYO0FBQUEsR0FiVDtBQWNBLFNBQU8sQ0FBUDtBQUNELENBaEJEOztlQWtCZVQsaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBmb3JFYWNoLCBzb3J0QnksIHJlZHVjZSxcbn0gZnJvbSAnbG9kYXNoJztcblxuY29uc3Qgc2VuZFJlcXVlc3QgPSAodXJsKSA9PiB7XG4gIC8qIGVzbGludC1kaXNhYmxlICovXG4gIGNvbnN0IHhodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgY29uc3QgcmVxID0gbmV3IFByb21pc2UoKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB4aHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSA0ICYmIHRoaXMuc3RhdHVzID09PSAyMDApIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgICAgICBjb25zdCByZXN1bHQgPSB4aHR0cC5yZXNwb25zZVRleHQ7XG4gICAgICAgIHJlc29sdmUoSlNPTi5wYXJzZShyZXN1bHQpKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5yZWFkeVN0YXRlID09PSA0ICYmIHRoaXMuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihgRXJyb3IhICR7dGhpcy5yZWFkeVN0YXRlfSAke3RoaXMuc3RhdHVzfWApKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHhodHRwLm9wZW4oJ1BPU1QnLCB1cmwsIHRydWUpO1xuICAgIHhodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTtcbiAgICB4aHR0cC5zZW5kKCdtb2JpbGVfY29kZXM9Z2V0Jyk7XG4gIH0pKTtcbiAgcmV0dXJuIHJlcTtcbiAgLyogZXNsaW50LWVuYWJsZSAqL1xufTtcblxuY29uc3QgcmVuZGVyTGFiZWwgPSAob2JqKSA9PiB7XG4gIGNvbnN0IGxhYmVsSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIGxhYmVsSW5wdXQuZm9yID0gb2JqLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbnB1dCcpLmlkO1xuICBsYWJlbElucHV0LnRleHRDb250ZW50ID0gJyArJztcbiAgb2JqLmFwcGVuZENoaWxkKGxhYmVsSW5wdXQpO1xuICByZXR1cm4gb2JqO1xufTtcblxuY29uc3QgbW9iaWxlRm9ybWF0ID0gKGFycikgPT4ge1xuICBjb25zdCBzdHIgPSByZWR1Y2UoYXJyLCAoYWNjLCBpdGVtLCBrZXkpID0+IHtcbiAgICBsZXQgcmVzID0gYWNjO1xuICAgIGlmIChrZXkgPT09IDIgfHwga2V5ID09PSA1KSB7XG4gICAgICByZXMgKz0gaXRlbTtcbiAgICAgIHJlcyArPSAnLSc7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH1cbiAgICByZXMgKz0gaXRlbTtcbiAgICByZXR1cm4gcmVzO1xuICB9LCAnJyk7XG4gIHJldHVybiBzdHI7XG59O1xuXG5jb25zdCByZW5kZXJEcm9wRG93bkxpc3QgPSAob2JqLFxuICBTb3J0ZWRGbGFncyxcbiAgaW5wdXRNb2JpbGVEZWZhdWx0LFxuICBpbnB1dENvdW50cnlDb2RlRGVmYXVsdCxcbiAgaGlkZGVuSW5wdXROYW1lLFxuICBib3JkZXJTdHlsZSkgPT4ge1xuICBjb25zdCBkcm9wRG93bkhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBjb25zdCBkcm9wRG93bklucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBjb25zdCBkcm9wRG93bkxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBjb25zdCBkcm9wRG93bkhpZGRlbklucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBjb25zdCBkcm9wRG93bkFycm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblxuICBkcm9wRG93bkxpc3QuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24tbGlzdCc7XG4gIGRyb3BEb3duSGVhZGVyLmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLWRyb3Bkb3duLWhlYWRlcic7XG4gIGlmIChib3JkZXJTdHlsZSA9PT0gJ3JlZCcpIHtcbiAgICBkcm9wRG93bklucHV0LmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLWRyb3Bkb3duLWlucHV0LXJlZCc7XG4gIH0gZWxzZSBpZiAoYm9yZGVyU3R5bGUgPT09ICdkZWZpbmUnKSB7XG4gICAgZHJvcERvd25JbnB1dC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1kcm9wZG93bi1pbnB1dCc7XG4gIH1cblxuXG4gIGRyb3BEb3duSW5wdXQubmFtZSA9ICdjb3VudHJ5X2NvZGUnO1xuICBkcm9wRG93bklucHV0LnJlYWRPbmx5ID0gdHJ1ZTtcbiAgZHJvcERvd25JbnB1dC5wbGFjZWhvbGRlciA9ICfQutC+0LQnO1xuICBkcm9wRG93bklucHV0Lm1heExlbmd0aCA9IDQ7XG4gIGRyb3BEb3duSW5wdXQudmFsdWUgPSBpbnB1dENvdW50cnlDb2RlRGVmYXVsdDtcblxuICBkcm9wRG93bkhpZGRlbklucHV0LnR5cGUgPSAnaGlkZGVuJztcbiAgZHJvcERvd25IaWRkZW5JbnB1dC5uYW1lID0gaGlkZGVuSW5wdXROYW1lIHx8ICdtb2JpbGVJbnB1dF9Nb2JpbGUnO1xuXG4gIGRyb3BEb3duSGVhZGVyLmFwcGVuZENoaWxkKGRyb3BEb3duSW5wdXQpO1xuXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB1bC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1kcm9wZG93bi11bCc7XG5cbiAgZm9yRWFjaChTb3J0ZWRGbGFncywgKGVsKSA9PiB7XG4gICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgbGV0IGltZ0ZsYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICBsZXQgbGlUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgbGkuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24tbGknO1xuICAgIGltZ0ZsYWcuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24taW1nZmxhZyc7XG4gICAgbGlUZXh0LmNsYXNzTmFtZSA9ICdtb2JpbGVfaW5wdXQtLWRyb3Bkb3duLWxpdGV4dCc7XG5cbiAgICBsaVRleHQudGV4dENvbnRlbnQgPSBlbC5tb2JpbGVfY29kZTtcblxuICAgIGltZ0ZsYWcuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCguLi9pbWcvZmxhZ3MvJHtlbC5mbGFnX3BpY3R1cmVfbmFtZX0pYDtcbiAgICAvLyBpbWdGbGFnLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoaW1nL2ZsYWdzLyR7ZWwuZmxhZ19waWN0dXJlX25hbWV9KWA7XG5cbiAgICBsaS5hcHBlbmRDaGlsZChpbWdGbGFnKTtcbiAgICBsaS5hcHBlbmRDaGlsZChsaVRleHQpO1xuXG4gICAgbGkudGl0bGUgPSBlbC5uYW1lX2N5cjtcbiAgICBsaS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGRyb3BEb3duSW5wdXQudmFsdWUgPSBsaVRleHQudGV4dENvbnRlbnQ7XG4gICAgICBkcm9wRG93bkxpc3Quc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9KTtcbiAgICB1bC5hcHBlbmRDaGlsZChsaSk7XG4gIH0pO1xuXG4gIGRyb3BEb3duTGlzdC5hcHBlbmRDaGlsZCh1bCk7XG5cbiAgY29uc3QgbW9iaWxlSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIGlmIChib3JkZXJTdHlsZSA9PT0gJ3JlZCcpIHtcbiAgICBtb2JpbGVJbnB1dC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1tb2JpbGUtaW5wdXQtcmVkJztcbiAgfSBlbHNlIGlmIChib3JkZXJTdHlsZSA9PT0gJ2RlZmluZScpIHtcbiAgICBtb2JpbGVJbnB1dC5jbGFzc05hbWUgPSAnbW9iaWxlX2lucHV0LS1tb2JpbGUtaW5wdXQnO1xuICB9XG5cbiAgbW9iaWxlSW5wdXQucGF0dGVybiA9ICdcXFxcZHszfShcXFxcc3wtKVxcXFxkezN9KFxcXFxzfC0pXFxcXGR7NH0nO1xuICBtb2JpbGVJbnB1dC5wbGFjZWhvbGRlciA9ICdYWFgtWFhYLVhYWFgnO1xuICBtb2JpbGVJbnB1dC50aXRsZSA9ICfQvdC+0LzQtdGAINC80L7QsdC40LvRjNC90L7Qs9C+INGC0LXQu9C10YTQvtC90LAnO1xuICBtb2JpbGVJbnB1dC50eXBlID0gJ3RlbCc7XG4gIG1vYmlsZUlucHV0LnJlcXVpcmVkID0gdHJ1ZTtcbiAgbW9iaWxlSW5wdXQudmFsdWUgPSBtb2JpbGVGb3JtYXQoaW5wdXRNb2JpbGVEZWZhdWx0KTtcbiAgbW9iaWxlSW5wdXQubmFtZSA9ICdtb2JpbGVfbnVtYmVyJztcbiAgbW9iaWxlSW5wdXQuYXV0b2NvbXBsZXRlID0gJ29mZic7XG5cbiAgb2JqLmFwcGVuZENoaWxkKGRyb3BEb3duSGVhZGVyKTtcblxuICBkcm9wRG93bkhlYWRlci5hcHBlbmRDaGlsZChkcm9wRG93bkFycm93KTtcblxuICBvYmouYXBwZW5kQ2hpbGQobW9iaWxlSW5wdXQpO1xuXG4gIG9iai5hcHBlbmRDaGlsZChkcm9wRG93bkxpc3QpO1xuXG4gIGRyb3BEb3duSGlkZGVuSW5wdXQudmFsdWUgPSBtb2JpbGVGb3JtYXQoaW5wdXRNb2JpbGVEZWZhdWx0KTtcblxuICBvYmouYXBwZW5kQ2hpbGQoZHJvcERvd25IaWRkZW5JbnB1dCk7XG5cbiAgY29uc3QgSGlkZGVuSW5wdXRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIGRyb3BEb3duSGlkZGVuSW5wdXQudmFsdWUgPSBkcm9wRG93bklucHV0LnZhbHVlICsgbW9iaWxlSW5wdXQudmFsdWU7XG4gICAgcmV0dXJuIGRyb3BEb3duSGlkZGVuSW5wdXQudmFsdWU7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2VsZWN0aW9uSW5kZXggPSAoZSkgPT4ge1xuICAgIGlmIChlLnRhcmdldC5zZWxlY3Rpb25TdGFydCA9PT0gZS50YXJnZXQuc2VsZWN0aW9uRW5kKSB7XG4gICAgICBpZiAoZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPj0gMCAmJiBlLnRhcmdldC5zZWxlY3Rpb25TdGFydCA8IDMpIHtcbiAgICAgICAgcmV0dXJuIHsgaW5kZXg6IGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0LCBjb3VudDogMSB9O1xuICAgICAgfVxuICAgICAgaWYgKGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0ID4gMyAmJiBlLnRhcmdldC5zZWxlY3Rpb25TdGFydCA8IDcpIHtcbiAgICAgICAgcmV0dXJuIHsgaW5kZXg6IGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0IC0gMSwgY291bnQ6IDEgfTtcbiAgICAgIH1cbiAgICAgIGlmIChlLnRhcmdldC5zZWxlY3Rpb25TdGFydCA+IDcgJiYgZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPD0gMTIpIHtcbiAgICAgICAgcmV0dXJuIHsgaW5kZXg6IGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0IC0gMiwgY291bnQ6IDEgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gZml4bWU6XG4gICAgbGV0IGNvdW50ID0gMDtcblxuICAgIGlmIChlLnRhcmdldC5zZWxlY3Rpb25TdGFydCA+PSAwICYmIGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0IDwgM1xuICAgICAgJiYgZS50YXJnZXQuc2VsZWN0aW9uRW5kID4gMCAmJiBlLnRhcmdldC5zZWxlY3Rpb25FbmQgPCAzKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnMSA9PicpO1xuICAgICAgY291bnQgPSBlLnRhcmdldC5zZWxlY3Rpb25FbmQgLSBlLnRhcmdldC5zZWxlY3Rpb25TdGFydDtcbiAgICAgIHJldHVybiB7IGluZGV4OiBlLnRhcmdldC5zZWxlY3Rpb25TdGFydCwgY250OiBjb3VudCB9O1xuICAgIH1cbiAgICBpZiAoZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPiAzICYmIGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0IDwgN1xuICAgICYmIGUudGFyZ2V0LnNlbGVjdGlvbkVuZCA+IDMgJiYgZS50YXJnZXQuc2VsZWN0aW9uRW5kIDwgNykge1xuICAgICAgLy8gY29uc29sZS5sb2coJzIgPT4nKTtcbiAgICAgIGNvdW50ID0gZS50YXJnZXQuc2VsZWN0aW9uRW5kIC0gZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgICByZXR1cm4geyBpbmRleDogZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgLSAxLCBjbnQ6IGNvdW50IH07XG4gICAgfVxuICAgIGlmIChlLnRhcmdldC5zZWxlY3Rpb25TdGFydCA+IDcgJiYgZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPD0gMTJcbiAgICAmJiBlLnRhcmdldC5zZWxlY3Rpb25FbmQgPiA4ICYmIGUudGFyZ2V0LnNlbGVjdGlvbkVuZCA8PSAxMikge1xuICAgICAgLy8gY29uc29sZS5sb2coJzMgPT4nKTtcbiAgICAgIGNvdW50ID0gZS50YXJnZXQuc2VsZWN0aW9uRW5kIC0gZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgICByZXR1cm4geyBpbmRleDogZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgLSAyLCBjbnQ6IGNvdW50IH07XG4gICAgfVxuXG4gICAgaWYgKGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0ID49IDAgJiYgZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPCAzXG4gICAgICAmJiBlLnRhcmdldC5zZWxlY3Rpb25FbmQgPiAzICYmIGUudGFyZ2V0LnNlbGVjdGlvbkVuZCA8PSA3KSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnNCA9PicpO1xuICAgICAgY291bnQgPSBlLnRhcmdldC5zZWxlY3Rpb25FbmQgLSBlLnRhcmdldC5zZWxlY3Rpb25TdGFydCAtIDE7XG4gICAgICByZXR1cm4geyBpbmRleDogZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQsIGNudDogY291bnQgfTtcbiAgICB9XG4gICAgaWYgKGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0ID49IDAgJiYgZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPD0gM1xuICAgICAgJiYgZS50YXJnZXQuc2VsZWN0aW9uRW5kID4gNyAmJiBlLnRhcmdldC5zZWxlY3Rpb25FbmQgPD0gMTIpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCc1ID0+Jyk7XG4gICAgICBjb3VudCA9IGUudGFyZ2V0LnNlbGVjdGlvbkVuZCAtIGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0IC0gMjtcbiAgICAgIHJldHVybiB7IGluZGV4OiBlLnRhcmdldC5zZWxlY3Rpb25TdGFydCwgY250OiBjb3VudCB9O1xuICAgIH1cbiAgICBpZiAoZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPiAzICYmIGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0IDw9IDdcbiAgICAgICYmIGUudGFyZ2V0LnNlbGVjdGlvbkVuZCA+PSAzICYmIGUudGFyZ2V0LnNlbGVjdGlvbkVuZCA8PSAxMikge1xuICAgICAgLy8gY29uc29sZS5sb2coJzYgPT4nKTtcbiAgICAgIGNvdW50ID0gZS50YXJnZXQuc2VsZWN0aW9uRW5kIC0gZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgLSAxO1xuICAgICAgcmV0dXJuIHsgaW5kZXg6IGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0IC0gMSwgY250OiBjb3VudCB9O1xuICAgIH1cbiAgICByZXR1cm4geyBpbmRleDogZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQsIGNvdW50IH07XG4gIH07XG5cbiAgY29uc3Qga2V5YnVmID0gaW5wdXRNb2JpbGVEZWZhdWx0LnNwbGl0KCcnKTtcbiAgY29uc29sZS53YXJuKCdpbnB1dE1vYmlsZURlZmF1bHQuc3BsaXQ6ICcsIGtleWJ1Zik7XG4gIC8vINC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOINCyINCx0YPRhNC10YAgKyDQvtCx0YDQsNCx0L7RgtC60LAg0L3QsNC20LDRgtC40Lkg0YHRgtGA0LXQu9C+0LpcbiAgbW9iaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsgY29uc29sZS5sb2coZS5rZXkpOyB9KTtcbiAgbW9iaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XG4gICAgY29uc29sZS5sb2coZS5rZXkpO1xuICAgIGNvbnNvbGUud2FybihrZXlidWYubGVuZ3RoKTtcbiAgICAvLyBBcnJvd1JpZ2h0IEFycm93TGVmdCBBcnJvd1VwIEFycm93RG93biBEZWxldGVcbiAgICBpZiAoaXNOYU4ocGFyc2VJbnQoZS5rZXksIDEwKSkgJiYgZS5rZXkgIT09ICdCYWNrc3BhY2UnICYmIGUua2V5ICE9PSAnRW50ZXInICYmIGUua2V5ICE9PSAnRGVsZXRlJyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgJiYgZS5rZXkgIT09ICdBcnJvd1JpZ2h0JyAmJiBlLmtleSAhPT0gJ0Fycm93TGVmdCcpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoa2V5YnVmLmxlbmd0aCA+PSAxMCAmJiBlLmtleSAhPT0gJ0JhY2tzcGFjZScmJiBlLmtleSAhPT0gJ0VudGVyJyAmJiBlLmtleSAhPT0gJ0RlbGV0ZScgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgICAgJiYgZS5rZXkgIT09ICdBcnJvd1JpZ2h0JyAmJiBlLmtleSAhPT0gJ0Fycm93TGVmdCcpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLyogZml4bWUgKi9cbiAgICBpZiAoZS5rZXkgPT09ICdCYWNrc3BhY2UnKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAvLyBtb2JpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgLy8gY29uc29sZS5sb2coa2V5YnVmW2UudGFyZ2V0LnNlbGVjdGlvblN0YXJ0XSk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhlLnRhcmdldC5zZWxlY3Rpb25TdGFydCk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhlLnRhcmdldC5zZWxlY3Rpb25FbmQpO1xuICAgICAgY29uc29sZS5sb2coZ2V0U2VsZWN0aW9uSW5kZXgoZSkpO1xuICAgICAgY29uc3Qgc3BsZHQgPSBnZXRTZWxlY3Rpb25JbmRleChlKTtcbiAgICAgIC8qIGZpeG1lICBpdGVtcy5zcGxpY2UoMSwgMSwgMTAxMCk7ICovXG4gICAgICBtb2JpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAga2V5YnVmLnNwbGljZShzcGxkdC5pbmRleCwgc3BsZHQuY291bnQpO1xuICAgICAgY29uc29sZS53YXJuKCdrZXlidWY6ICcsIGtleWJ1Zik7XG4gICAgICBtb2JpbGVJbnB1dC52YWx1ZSA9IG1vYmlsZUZvcm1hdChrZXlidWYpO1xuICAgICAgSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8qIGZpeG1lOiAqL1xuICAgIGlmIChlLmtleSA9PT0gJ0RlbGV0ZScpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIG1vYmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICAvKiBmaXhtZTogKi9cbiAgICAgIGtleWJ1Zi5wb3AoKTtcbiAgICAgIG1vYmlsZUlucHV0LnZhbHVlID0gbW9iaWxlRm9ybWF0KGtleWJ1Zik7XG4gICAgICBIaWRkZW5JbnB1dEhhbmRsZXIoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZS5rZXkgPT09ICdBcnJvd0xlZnQnKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAvLyBtb2JpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgaWYgKGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0ID4gMCkge1xuICAgICAgICBlLnRhcmdldC5zZWxlY3Rpb25TdGFydCAtPSAxO1xuICAgICAgICBlLnRhcmdldC5zZWxlY3Rpb25FbmQgLT0gMTtcbiAgICAgIH1cblxuICAgICAgLyogZml4bWU6ICovXG4gICAgICAvLyBrZXlidWYucG9wKCk7XG4gICAgICAvLyBtb2JpbGVJbnB1dC52YWx1ZSA9IG1vYmlsZUZvcm1hdChrZXlidWYpO1xuICAgICAgLy8gSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGUua2V5ID09PSAnQXJyb3dSaWdodCcpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIC8vIG1vYmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICBpZiAoZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPj0gMCAmJiBlLnRhcmdldC5zZWxlY3Rpb25FbmQgPD0gMTIpIHtcbiAgICAgICAgZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgKz0gMTtcbiAgICAgIH1cblxuICAgICAgLyogZml4bWU6ICovXG4gICAgICAvLyBrZXlidWYucG9wKCk7XG4gICAgICAvLyBtb2JpbGVJbnB1dC52YWx1ZSA9IG1vYmlsZUZvcm1hdChrZXlidWYpO1xuICAgICAgLy8gSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIG1vYmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAga2V5YnVmLnB1c2goZS5rZXkpO1xuICAgIG1vYmlsZUlucHV0LnZhbHVlID0gbW9iaWxlRm9ybWF0KGtleWJ1Zik7XG4gICAgSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gIH0pO1xuICBtb2JpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChlKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ0NhcmV0IGF0OiAnLCBlLnRhcmdldC5zZWxlY3Rpb25TdGFydCk7XG4gIH0pO1xuXG4gIGRyb3BEb3duTGlzdC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKCkgPT4ge1xuICAgIGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIEhpZGRlbklucHV0SGFuZGxlcigpO1xuICB9KTtcblxuICBkcm9wRG93bklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID0gKGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snKSA/ICdub25lJyA6ICdibG9jayc7XG4gICAgSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gIH0pO1xuXG4gIGRyb3BEb3duQXJyb3cuY2xhc3NOYW1lID0gJ21vYmlsZV9pbnB1dC0tZHJvcGRvd24taGVhZGVyLWFycm93JztcbiAgZHJvcERvd25BcnJvdy50ZXh0Q29udGVudCA9ICfilrwnO1xuICBkcm9wRG93bkFycm93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID0gKGRyb3BEb3duTGlzdC5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snKSA/ICdub25lJyA6ICdibG9jayc7XG4gICAgSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gIH0pO1xuXG4gIG1vYmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzaW4nLCAoKSA9PiB7XG4gICAgZHJvcERvd25MaXN0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgSGlkZGVuSW5wdXRIYW5kbGVyKCk7XG4gIH0pO1xuXG4gIHJldHVybiBvYmo7XG59O1xuXG5jb25zdCB1cFVzZWRDb3VudHJ5ID0gKGNvZGVzLCBjb3VudHJpZXMpID0+IHtcbiAgY29uc3QgdXBMaXN0ID0gY29kZXMuZmlsdGVyKChlbCkgPT4gY291bnRyaWVzLmluY2x1ZGVzKGVsLm5hbWVfbGF0KSk7XG4gIGNvbnN0IHJlc3VsdCA9IHVwTGlzdC5jb25jYXQoY29kZXMpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcblxuY29uc3QgZm9ybWF0Q29kZXMgPSAoYXJyKSA9PiB7XG4gIGNvbnN0IHNvcnRBcnIgPSBzb3J0QnkoYXJyLm1vYmlsZV9jb2RlcywgWyhvKSA9PiBvLm1vYmlsZV9jb2RlXSk7XG4gIHJldHVybiB1cFVzZWRDb3VudHJ5KHNvcnRBcnIsIFsnUnVzc2lhJ10pO1xufTtcblxuY29uc3QgcmVuZGVyTW9iaWxlSW5wdXQgPSAoY29uZmlnKSA9PiB7XG4gIHNlbmRSZXF1ZXN0KGNvbmZpZy51cmwpXG4gICAgLnRoZW4oKE1vYmlsZUNvZGVzKSA9PiB7XG4gICAgICBjb25zdCBTb3J0ZWRNb2JpbGVDb2RlcyA9IGZvcm1hdENvZGVzKE1vYmlsZUNvZGVzKTtcbiAgICAgIHJlbmRlckxhYmVsKGNvbmZpZy5kb21PYmplY3QpO1xuICAgICAgcmVuZGVyRHJvcERvd25MaXN0KFxuICAgICAgICBjb25maWcuZG9tT2JqZWN0LFxuICAgICAgICBTb3J0ZWRNb2JpbGVDb2RlcyxcbiAgICAgICAgY29uZmlnLmRlZmF1bHRNb2JpbGUsXG4gICAgICAgIGNvbmZpZy5kZWZhdWx0Q291bnRyeUNvZGUsXG4gICAgICAgIGNvbmZpZy5oaWRkZW5JbnB1dE5hbWUsXG4gICAgICAgIGNvbmZpZy5ib3JkZXJTdHlsZSxcbiAgICAgICk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycm9yKSA9PiBjb25zb2xlLmxvZyhlcnJvcikpO1xuICByZXR1cm4gMDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHJlbmRlck1vYmlsZUlucHV0O1xuIl19